<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:content-core fill-slot="main">
    <metal:content-core define-macro="content-core"
                        tal:define="kssClassesView context/@@kss_field_decorator_view;
                                    getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                                    templateId template/getId;
                                    toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                                    server python:here.getServer().lower().replace('\'','');
                                    charname python:here.Title().lower();
                                    dummy here/autoUpdateData;">
      <h1 tal:content="string:${here/Title} <${here/getGuild}>"/>
      <div tal:condition="python:not here.getLevel() or not int(here.getLevel())==90">
        Not max level!!!
      </div>
      <div tal:condition="python:here.getLevel() and int(here.getLevel())==90">
                                    
        <div class="updateData">
          <form tal:attributes="action string:${here/absolute_url}/update_data_script">
            <input type="submit" class="context" value="update" />
            <span class="discreet" tal:content="python:'last cached: ' + toLocalizedTime(here.getCacheDate(),long_format=1)"/>
          </form>
        </div>

        <div class="wowcharinfo">
          <table class="vertical listing">
						<tr>
							<th>Armory link</th>
							<td>
							  <a tal:content="string:http://us.battle.net/wow/en/character/${server}/${charname}/advanced"
							     tal:attributes="href string:http://us.battle.net/wow/en/character/${server}/${charname}/advanced"/>
							</td>
						</tr>
						<tr tal:condition="here/getGuild">
							<th>Guild</th>
							<td>
							  <a tal:content="string:http://us.battle.net/wow/en/guild/${server}/${here/getGuild}/"
							     tal:attributes="href string:http://us.battle.net/wow/en/guild/${server}/${here/getGuild}/"/>
						</tr>
						<tr>
							<th>Server</th>
							<td tal:content="here/getServer|string:"/>
						</tr>
						<tr>
							<th>Class</th>
							<td tal:content="here/getClass|string:"/>
						</tr>
						<tr>
							<th>Race</th>
							<td tal:content="here/getRace|string:"/>
						</tr>
						<tr>
						  <th>Gender</th>
						  <td tal:content="here/getGender|string:"/>
						</tr>
						<tr>
						  <th>Level</th>
						  <td tal:content="here/getLevel|string:"/>
						</tr>
						<tr>
						  <th>Titles</th>
						  <td tal:content="here/getTitles"/>
						</tr>
						<tr>
						  <th>Pets (unique)</th>
						  <td tal:content="here/getCompanions"/>
						</tr>
						<tr>
						  <th>Mounts</th>
						  <td tal:content="here/getMounts"/>
						</tr>
          </table>
        </div>

        <div class="avatarFrame">
          <div tal:condition="here/getAvatar">
          	<img tal:replace="structure python:context.tag(scale='thumb', css_class='mediaImage')" src="" alt="" /><br/>
          </div>
          <span tal:content="here/getPoints"/> achievement points.
            
          <div tal:condition="python:len(here.getSpecs())>0">
            <h3>Main Spec: <span tal:content="python:here.getSpecs()[0]['name']"/></h3>
            <ul class="visualNoMarker">
              <tal:talent repeat="talent here/getMainTalents">
                <li>
                  <span tal:content="python:(int(talent['tier'])+1)*15"/>:
                  <img tal:attributes="src string:http://wow.zamimg.com/images/wow/icons/small/${talent/icon}.jpg"/>
                  <a tal:attributes="href string:http://www.wowhead.com?spell=${talent/id}"
                     tal:content="talent/name"/>
                </li>
              </tal:talent>
            </ul>
          </div>
            
          <div tal:condition="python:len(here.getSpecs())>1">
            <h3>Second Spec: <span tal:content="python:here.getSpecs()[1]['name']"/></h3>
            <ul class="visualNoMarker">
              <tal:talent repeat="talent here/getSecondTalents">
                <li>
                  <span tal:content="python:(int(talent['tier'])+1)*15"/>:
                  <img tal:attributes="src string:http://wow.zamimg.com/images/wow/icons/small/${talent/icon}.jpg"/>
                  <a tal:attributes="href string:http://www.wowhead.com?spell=${talent/id}"
                     tal:content="talent/name"/>
                </li>
              </tal:talent>
            </ul>
          </div>
          
        </div>
        
       <h2>Stats</h2>
        <table class="listing verticle">
          <tr tal:condition="python:int(here.getAgility()) > int(here.getIntellect()) and int(here.getAgility()) > int(here.getStrength())">
            <th>Agility</th>
            <td tal:content="here/getAgility|string:;"/>
            <th>Stamina</th>
            <td tal:content="here/getStamina|string:;"/>
          </tr>
          <tr tal:condition="python:int(here.getStrength()) > int(here.getAgility()) and int(here.getStrength()) > int(here.getIntellect())">
            <th>Strength</th>
            <td tal:content="here/getStrength|string:;"/>
            <th>Stamina</th>
            <td tal:content="here/getStamina|string:;"/>
          </tr>
          <tr tal:condition="python:int(here.getIntellect()) > int(here.getAgility()) and int(here.getIntellect()) > int(here.getAgility())">
            <th>Intellect</th>
            <td tal:content="here/getIntellect|string:;"/>
            <th>Stamina</th>
            <td tal:content="here/getStamina|string:;"/>
          </tr>
          <tr>
            <th>Hit</th>
            <td tal:content="here/getHit|string:;"/>
            <th>Crit</th>
            <td tal:content="here/getCrit|string:;"/>
          </tr>
          <tr>
            <th>Haste</th>
            <td tal:content="here/getHaste|string:;"/>
            <th>Mastery</th>
            <td tal:content="here/getMastery|string:;"/>
          </tr>
          <tr tal:condition="python:int(here.getSpirit())>500">
            <th>Spirit</th>
            <td tal:content="here/getSpirit|string:;"/>
            <th/><td/>
          </tr>
        </table>
        <div class="visualClear"> </div>
        
        <h2>Progression</h2>
        <tal:tier repeat="tier here/progressionDisplay">
          <h3 tal:content="tier/tier"/>
          <tal:raid repeat="raid tier/raids">
            <table class="progressionTable">
              <thead>
                <tr>
                  <th class="raidName" tal:attributes="colspan python:len(raid['bosses'])" tal:content="raid/raid"/>
                </tr>
                <tr>
                  <tal:bosses repeat="boss raid/bosses">
                    <th tal:content="boss/name"/>
                  </tal:bosses>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <tal:boss repeat="boss raid/bosses">
                    <td tal:attributes="class python:int(boss['hkills'])>0 and 'killed' or 'notKilled'">
                      <span tal:content="string:${boss/hkills} heroic kill(s)"/><br/>
                      <span tal:content="string:${boss/nkills} normal kill(s)"/>
                    </td>
                  </tal:boss>
                </tr>
              </tbody>
            </table>
          </tal:raid>
        </tal:tier>
        
      </div>

    </metal:content-core>
</metal:content-core>

</body>
</html>
