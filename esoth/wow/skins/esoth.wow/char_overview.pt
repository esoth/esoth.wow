<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:content-core fill-slot="main">
    <metal:content-core define-macro="content-core"
                        tal:define="kssClassesView context/@@kss_field_decorator_view;
                                    getKssClasses nocall:kssClassesView/getKssClassesInlineEditable;
                                    templateId template/getId;
                                    toLocalizedTime nocall:context/@@plone/toLocalizedTime;
                                    characters here/players;
                                    use_view_action site_properties/typesUseViewActionInListings|python:();
                                    normalizeString nocall: context/plone_utils/normalizeString;
                                    plone_view context/@@plone;">

        <h1 tal:content="string:${here/Title}"/>

        <form tal:attributes="action string:${here/absolute_url}/update_display_script">
           <input type="submit" value="Update all"/>
        </form>
                                    
        <table class="listing">
          <thead>
            <tr>
              <th>Character Name</th>
              <th>*</th>
              <th>Server</th>
              <th>Guild</th>
              <th>Class</th>
              <th>Achievement Points</th>
              <th>Mounts</th>
              <th>Pets (unique)</th>
              <th>Titles</th>
              <th>iLvl (total)</th>
              <th>iLvl (equipped)</th>
            </tr>
          </thead>
          <tbody>
            <tal:char repeat="char characters">
              <tr>
                <td>
                    <span class="summary"
                          tal:define="char_wf_state char/review_state|python: context.portal_workflow.getInfoFor(char, 'review_state', '');
                                      char_wf_state_class python:'state-' + normalizeString(char_wf_state);
                                      char_icon python:plone_view.getIcon(char);">
                        <img tal:replace="structure char_icon/html_tag" />
                        <a href="#"
                           tal:attributes="href char/getURL;
                                           class string:contenttype-wowchar $char_wf_state_class url"
                           tal:content="char/Title">
                            char Title
                        </a>
                    </span>
                </td>
                <td>
                  <tal:avatar condition="char/hasAvatar">
                    <img tal:attributes="src string:${char/getURL}/@@images/avatar/icon"/>
                  </tal:avatar>
                </td>
                <td tal:content="char/serverTitle"/>
                <td>
                  <tal:guild condition="char/guild">
                    &lt;<span tal:omit-tag="" tal:content="char/guild"/>&gt;
                  </tal:guild>
                </td>
                <td tal:content="char/klass"/>
                <td tal:content="char/points"/>
                <td tal:content="char/mounts"/>
                <td tal:content="char/numcompanions"/>
                <td tal:content="char/titles"/>
                <td tal:content="char/averageItemLevel"/>
                <td tal:content="char/averageItemLevelEquipped"/>
              </tr>
            </tal:char>
          </tbody>
        </table>
            

    </metal:content-core>
</metal:content-core>

</body>
</html>