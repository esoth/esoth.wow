<metal:header define-macro="char_header">
  <table id="char_header"
         tal:define="dummy here/autoUpdateData;">
    <tr>
      <td id="border-left" href="#"/>
      <td class="link"
          tal:attributes="id python:templateId == '@@player-view' and 'selectedGearTab';
                          href string:${context/absolute_url}/@@player-view">
        <a tal:attributes="href string:${context/absolute_url}/@@player-view">Character</a>
      </td>
      <td class="link"
          tal:attributes="id python:templateId == '@@gearpath-view' and 'selectedGearTab';
                          href string:${context/absolute_url}/@@gearpath-view">
        <a tal:attributes="href string:${context/absolute_url}/@@gearpath-view">Gear Path</a>
      </td>
      <td class="link"
          tal:attributes="id python:templateId == '@@pets-view' and 'selectedGearTab';
                          href string:${context/absolute_url}/@@pets-view">
        <a tal:attributes="href string:${context/absolute_url}/@@pets-view">Battle Pets</a>
      </td>
      <td class="link"
          tal:attributes="href string:${context/absolute_url}/@@armory">
        <a tal:attributes="href string:${context/absolute_url}/@@armory">Update from Blizzard</a>
        <span class="discreet">(last updated: <span tal:content="context/displaylastupdated"/>)</span>
      </td>
      <td id="border-right" href="#"/>
    </tr>
  </table>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#char_header td.link').click(function() {
        top.location = $(this).attr('href');
      });
    });
  </script>
</metal:header>

<metal:item define-macro="item"
            tal:define="slot slot|string:;">
  <dt tal:attributes="id string:fieldsetlegend-${slot}"
      tal:content="slotName" />
  <dd tal:attributes="id string:fieldset-${slot}">
    <table class="vertical listing">
      <tr>
        <th>Name</th>
        <th>Boss</th>
        <tal:edit condition="python:checkPermission('Modify portal content',context)">
          <th colspan="4">actions</th>
        </tal:edit>
      </tr>
      <tal:itm repeat="item items/itms">
        <tr tal:attributes="slot slot;
                            class python:' '.join([c for c in [item['equipped'] and 'equippedItem',item['acquired'] and 'acquiredItem',item['bis'] and 'bisItem',item['downgrade'] and 'downgradeItem'] if c])">
          <td>
            <a class="slotItem"
               tal:attributes="href string:http://www.wowhead.com?item=${item/id}"
               tal:content="item/name"/>
          </td>
          <td tal:content="item/boss"/>
          <tal:edit condition="python:checkPermission('Modify portal content',context)">
            <td>
              <a tal:attributes="href string:${context/absolute_url}/@@gearpath-view?action=equip&item=${item/name}&slot=${slot};"
                 class="equip-link"
                 title="Equip - you are wearing this">
                <img tal:attributes="src string:$portal_url/equipped.png" />
              </a>
            </td>
            <td>
              <a tal:attributes="href string:${context/absolute_url}/@@gearpath-view?action=acquire&item=${item/name}&slot=${slot}"
                 class="acquire-link"
                 title="Acquire - acquired but not equipped">
                <img tal:attributes="src string:$portal_url/acquired.png" />
              </a>
            </td>
            <td>
              <a tal:attributes="href string:${context/absolute_url}/@@gearpath-view?action=bis&item=${item/name}&slot=${slot}"
                 class="bis-link"
                 title="BIS">
                <img tal:attributes="src string:$portal_url/bis.png" />
              </a>
            </td>
            <td>
              <a tal:attributes="href string:${context/absolute_url}/@@gearpath-view?action=downgrade&item=${item/name}&slot=${slot}"
                 class="downgrade-link"
                 title="Downgrade - downgrade from what is equipped">
                <img tal:attributes="src string:$portal_url/downgrade.png" />
              </a>
            </td>
          </tal:edit>
        </tr>
      </tal:itm>
    </table>
  </dd>
</metal:item>