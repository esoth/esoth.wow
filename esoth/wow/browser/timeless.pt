<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="plone">
<body>

<metal:main fill-slot="content">

  <h1>Going to Need a Bigger Bag</h1>
  
  <p>
    This page helps you track your progress on
    <a href="http://www.wowhead.com/achievement=8728">Going to Need a Bigger Bag</a>, an achievement monstrosity on
    the Timeless Isle. While the in game achievement tracker will show you your progress, this tool helps tie in
    each item with the creature(s) that drop it, their location, their spawn rarity, and whether or not it's a pet
    so that you can better plan your next task.
  </p>
  <br/>
  
  <p>
    Link: <a id="gnabb-link"
             tal:attributes="href string:${context/absolute_url}/gnabb?s="
             tal:content="string:${context/absolute_url}/gnabb?s=${request/s}" />
           <input id="gnabb-base" type="hidden"
            tal:attributes="value string:${context/absolute_url}/gnabb?s=" />
  </p>
                        
  <table class="listing nosort" id="timeless"
         tal:define="progress view/progress;
                     completed view/completed">
    <thead>
      <tr>
        <th>&nbsp;</th>
        <th>Item</th>
        <th>Source</th>
        <th>Location</th>
        <th>Rare Spawn</th>
        <th>Pet</th>
        <th>Alternative</th>
      </tr>
    </thead>
    <tbody>
      <tal:item repeat="item progress">
        <tr class="gnabb-row"
            tal:define="gnabbid string:item-${repeat/item/index}"
            tal:attributes="id gnabbid;
                            style python:item['id'] in completed and 'display:none'">
          <td>
            <input type="checkbox"
                   class="gnabb-item"
                   tal:attributes="checked python:item['id'] in completed and 'checked';"
                   onclick="gnabber($(this))" />
          </td>
          <td>
            <a tal:attributes="href string:http://www.wowhead.com/item=${item/id}"
               tal:content="item/name" />
          </td>
          <td tal:content="item/source" />
          <td tal:content="item/location" />
          <td>
            <tal:bool condition="item/rare" content="string:Yes" />
          </td>
          <td>
            <tal:bool condition="item/pet" content="string:Yes" />
          </td>
          <td tal:content="item/alternative" />
        </tr>
      </tal:item>
    </tbody>
  </table><br/>
  
  <a id="show-everything"
     onclick="$('.gnabb-row').show(); $(this).hide(); $('#hide-completed').show()"
     href="javascript:void(0)">
    Show All
  </a>
  <a id="hide-completed" style="display: none;"
     onclick="gnabber_hide(); $(this).hide(); $('#show-everything').show()"
     href="javascript:void(0)">
    Hide Completed
  </a>
  
  <script type="text/javascript">
    function gnabber_hide() {
      $('.gnabb-item').each(function (index) {
        if ( $(this).attr('checked') == 'checked' ) {
          $(this).closest('tr').hide();
        }
      });
    }
    
    function gnabber(o) {
      if (o.attr('checked') == 'checked') {
        row = o.closest('tr')
        row.addClass('completed-row')
        row.fadeOut('200',function () {
          row.hide();
        });
      }
      x = ''
      $('.gnabb-item').each(function (index) {
        var checked = $(this).attr('checked');
        x = (checked == 'checked') ? (x += '1') : x += '0';
      });
      var new_url = $('#gnabb-base').val()+x;
      $('#gnabb-link').attr('href',new_url);
      $('#gnabb-link').text(new_url);
    }
  </script>

</metal:main>

</body>
</html>